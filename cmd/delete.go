/*
Copyright ¬© 2026 NAME HERE <EMAIL ADDRESS>
*/
package cmd

import (
	"encoding/json"
	"fmt"
	"os"
	"strconv"

	"github.com/spf13/cobra"
)

// deleteCmd represents the delete command
var deleteCmd = &cobra.Command{
	Use:   "delete",
	Short: "–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ –Ω–æ–º–µ—Ä—É",
	Args:  cobra.ExactArgs(1), // Cobra –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω —Ä–æ–≤–Ω–æ 1 –∞—Ä–≥—É–º–µ–Ω—Ç,
	Run: func(cmd *cobra.Command, args []string) {
		// 1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ (–∏–Ω–¥–µ–∫—Å)
		idx, err := strconv.Atoi(args[0])
		if err != nil {
			fmt.Println("–û—à–∏–±–∫–∞: –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–¥–∞—á–∏")
			return
		}

		// 2. –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
		fileData, err := os.ReadFile("tasks.json")
		if err != nil {
			fmt.Println("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω")
			return
		}

		var tasks []Task
		json.Unmarshal(fileData, &tasks)

		// 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å
		// –ú—ã –≤—ã–≤–æ–¥–∏–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–∞—á–∏–Ω–∞—è —Å 1, –ø–æ—ç—Ç–æ–º—É –æ—Ç–Ω–∏–º–∞–µ–º 1 –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ª–∞–π—Å–æ–º
		realIdx := idx - 1
		if realIdx < 0 || realIdx >= len(tasks) {
			fmt.Println("–û—à–∏–±–∫–∞: –∑–∞–¥–∞—á–∏ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –Ω–µ—Ç")
			return
		}

		// 4. –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞—á—É –∏–∑ —Å–ª–∞–π—Å–∞
		// –ú—ã –±–µ—Ä–µ–º –≤—Å—ë –î–û –Ω—É–∂–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ –≤—Å–µ–º, —á—Ç–æ –ü–û–°–õ–ï –Ω–µ–≥–æ
		tasks = append(tasks[:realIdx], tasks[realIdx+1:]...)

		data, _ := json.MarshalIndent(tasks, "", "  ")
		os.WriteFile("tasks.json", data, 0644)

		fmt.Println("–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞! üóëÔ∏è")
	},
}

func init() {
	rootCmd.AddCommand(deleteCmd)
}

/*
tasks[:realIdx] ‚Äî –±–µ—Ä–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –Ω–∞—á–∞–ª–∞ –¥–æ —É–¥–∞–ª—è–µ–º–æ–≥–æ (–Ω–µ –≤–∫–ª—é—á–∞—è –µ–≥–æ).
tasks[realIdx+1:] ‚Äî –±–µ—Ä–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ—Å–ª–µ —É–¥–∞–ª—è–µ–º–æ–≥–æ –¥–æ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ü–∞.
... (variadic) ‚Äî —ç—Ç–æ ¬´—Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞¬ª.
–ú—ã –≥–æ–≤–æ—Ä–∏–º Go: ¬´–í–æ–∑—å–º–∏ —ç—Ç–æ—Ç –≤—Ç–æ—Ä–æ–π –∫—É—Å–æ–∫ —Å–ª–∞–π—Å–∞ –∏ –¥–æ–±–∞–≤—å –µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É –≤ –ø–µ—Ä–≤—ã–π –∫—É—Å–æ–∫¬ª.
–ë–µ–∑ —ç—Ç–∏—Ö —Ç–æ—á–µ–∫ Go –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Å—É–Ω—É—Ç—å —Å–ª–∞–π—Å –≤–Ω—É—Ç—Ä—å —Å–ª–∞–π—Å–∞, –∏ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞.
*/
